<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">
    <title>DemoHaxElement: demo-hax-element Demo</title>
    
    <script src="../../../node_modules/@haxtheweb/deduping-fix/deduping-fix.js"></script>

    <script type="module">
      import '../lib/lecture-player.js';
      import '../lib/lecture-anchor.js';
      import '@haxtheweb/self-check/self-check.js';
    </script>
  </head>
  <body>
    <button id="urlBtn" class="control">Change Url</button>
    <button id="scrollBtn" class="control">Scroll Video Into View</button>
    <button id="seekBtn" class="control">+ Go to timestamp</button>
    <button id="lectureBtn" class="control">Lecture Player</button>
  <lecture-player>
    <div class="pageContent">
      <h2 id="title1">Start of Video</h2>
      <p data-lecture-slide data-value=422 target="video-player" data-associatedID="title1">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
      <h2 id="section2">Next part in the video</h2>
      <p data-lecture-slide data-value=213 target="video-player" data-associatedID="section2">Lorem ipsum dolor sit amet consectetur adipiscing. Diam ut venenatis tellus in metus. Et netus et malesuada fames ac turpis egestas. Commodo quis imperdiet massa tincidunt nunc. Pulvinar etiam non quam lacus suspendisse faucibus interdum posuere lorem. <lecture-anchor >Index JS</lecture-anchor> enim facilisis gravida neque convallis. Amet volutpat consequat mauris nunc congue nisi vitae suscipit. Turpis nunc eget lorem dolor sed. Mattis enim ut tellus elementum sagittis vitae et leo. Lacus sed viverra tellus in hac habitasse platea. Luctus venenatis lectus magna fringilla. A diam sollicitudin tempor id. Congue nisi vitae suscipit tellus mauris. Et malesuada fames ac turpis egestas sed.</p>
      <h2 id="final">Final value section goes here</h2>
      <p data-lecture-slide data-value=253 target="video-player" data-associatedID="final">Enim ut tellus elementum sagittis. Suspendisse interdum consectetur libero id faucibus nisl tincidunt eget nullam. Arcu felis bibendum ut tristique et egestas. Pharetra pharetra massa massa ultricies mi quis hendrerit. A cras semper auctor vitae tempus quam pellentesque. Tincidunt vitae semper quis lectus nulla at volutpat. Semper viverra nam libero justo laoreet sit amet cursus. Nisl rhoncus mattis rhoncus urna neque viverra justo nec ultrices. Dignissim suspendisse in est ante in nibh mauris cursus mattis. Enim nulla aliquet porttitor lacus luctus accumsan tortor posuere. Dui id ornare arcu odio ut sem nulla pharetra. Maecenas accumsan lacus vel facilisis volutpat est velit. At lectus urna duis convallis convallis tellus id interdum velit. Fames ac turpis egestas maecenas pharetra convallis posuere morbi leo. Mauris vitae ultricies leo integer. Eget velit aliquet sagittis id consectetur purus ut faucibus.</p>
      <h2 id="heading3">Self Check</h2>
        <self-check data-lecture-slide data-value=322 target="video-player" data-associatedID="heading3" accent-color="light-blue" title="Sharks Self Check" image="https://upload.wikimedia.org/wikipedia/commons/5/56/White_shark.jpg"
        alt="Great White Shark">
        <span slot="question">How large can the average great white shark grow to be?</span>
        The Great White shark can grow to be 15 ft to more than 20 ft in length and weigh 2.5 tons or more.
        </self-check>
      <h2 data-lecture-slide data-primary="11" data-accent="1" data-value=12 target="video-player" data-associatedID="testSection">Test Section</h2>
      <span id="testSection">Extra 1</span>
    </div>
    <video-player id="video-player-1" source="https://www.youtube.com/embed/-MTSQjw5DrM?si=TDthCE9uHS07JxO0"></video-player>
  </lecture-player>
  </body>
</html>
<style>
  .control{
    padding: 12px;
    margin: 12px;
    font-size: 20px;
  }
  .space{
    height: 100vh;
  }
  #video-player-1{
    margin: 12px;
    height: 300px;
  }
</style>
<script>
  const urlBtn = document.getElementById('urlBtn');
  const scrollBtn = document.getElementById('scrollBtn');
  const seekBtn = document.getElementById('seekBtn');
  const lectureBtn = document.getElementById('lectureBtn');

  urlBtn.addEventListener('click', () => {
    window.location.hash = 'video-player-1--300';
    console.log(window.location.hash.split('--')[0]);
    console.log(window.location.hash.split('--')[1]);
  });

  scrollBtn.addEventListener('click', () => {
    if (window.location.hash && window.location.hash.split('--')) {
      const video = document.querySelector(window.location.hash.split('--')[0]);
    video.scrollIntoView();      
    }
  });

  seekBtn.addEventListener('click', async () => {
    const video = document.querySelector(globalThis.location.hash.split('--')[0]);
    video.setAttribute('element-visible', true);
    console.log(globalThis.location.hash.split('--')[1]);
    await video.scrollIntoView();
    video.play();
    globalThis.location.hash.split('--')[1] !== 'undefined' ? video.seek(globalThis.location.hash.split('--')[1]) : '';
  });

  lectureBtn.addEventListener('click', () => {
    globalThis.location.hash = 'video-player-1--300--lecture-player';

  });

  globalThis.addEventListener('hashchange', () => {
    console.log(globalThis.location.hash);
  });

  // globalThis.addEventListener('DOMContentLoaded', async () => {
  //   const hash = globalThis.location.hash;
  //   console.log(hash);
  //   var [id, timestamp] = hash.split('--');
  //   console.log(id, timestamp);
  //   if (id) {
  //     let video = document.querySelector(id);
  //     video.elementVisible = true;
  //     setTimeout(() => {
  //       if(id !== '#lecture-player-video'){
  //         console.log(globalThis.location.hash.split('--')[1]);
  //         video.scrollIntoView();
  //         setTimeout(() => {
  //           video.scrollIntoView();
  //           globalThis.location.hash.split('--')[1] !== 'undefined' ? video.seek(globalThis.location.hash.split('--')[1]) : '';
  //         }, 2000);
  //       }      
  //     }, 1000);
  //   }
  // });

  globalThis.addEventListener('pause', (e) => {
    let id = e.detail.getRootNode().host.id;
    let hash;
    hash = `${id}--${Math.floor(e.detail.media.currentTime) ? Math.floor(e.detail.media.currentTime) : 0}`;
    globalThis.location.hash = hash;
  });
  globalThis.addEventListener('play', (e) => {
    let id = e.detail.getRootNode().host.id;
    let hash;
    hash = `${id}--${Math.floor(e.detail.media.currentTime) ? Math.floor(e.detail.media.currentTime) : 0}`;
    globalThis.location.hash = hash;
  });
  globalThis.addEventListener('seek', (e) => {
    let id = e.detail.getRootNode().host.id;
    let hash;
    hash = `${id}--${Math.floor(e.detail.media.currentTime) ? Math.floor(e.detail.media.currentTime) : 0}`;
    globalThis.location.hash = hash;
  });

</script>